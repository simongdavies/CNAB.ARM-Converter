{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "providerName": {
      "type": "string"
    },
    "providerType": {
      "type": "string",
      "metadata": {
        "description": "Value can be Internal, External, Hidden, RegistrationFree, TenantOnly or LegacyRegistrationRequired. RegistrationFree is for providers that don't need subscriptions to explicitly register to use the provider. Hidden flag ensures that discovery APIs (GET /Providers) will not show the provider, however a user can still write to the provider explicitly. TenantOnly won't appear in Get /Providers and won't allow registration from users. LegacyRegistrationRequired is for legacy providers that need RDFE registration in addition to ARM registration."
      },
      "defaultValue": "Internal"
    },
    "providerAuthorizations": {
      "type": "array",
      "metadata": {
        "description": "Available only for first party providers, this section can be used to bootstrap Service-to-Service authentication and authorization for the provider's application. When set, it would allow provider to access users' subscription registered with them.Should be in the format {\"applicationId\": \"<Your app id whitelisted by RPaaS>\",\"roleDefinitionId\": \"<Role definition created by RPSAAS>\"}"
      },
      "defaultValue": []
    },
    "incidentRoutingService": {
      "type": "string",
      "metadata": {
        "description": "The Service in IcM when creating or transferring incidents to the RP."
      },
      "defaultValue": "Test Service"
    },
    "incidentRoutingTeam": {
      "type": "string",
      "metadata": {
        "description": "The Team in IcM when creating or transferring incidents to the RP."
      },
      "defaultValue": "Test Team"
    },
    "incidentContactEmail": {
      "type": "string",
      "metadata": {
        "description": "The email address of contacts for incidents related to the RP"
      },
      "defaultValue": "test@testservice.com"
    }
  },
  "resources": [
    {
      "type": "Microsoft.ProviderHub/providerregistrations",
      "apiVersion": "2020-09-01-preview",
      "name": "[parameters('providerName')]",
      "properties": {
        "providerType": "[parameters('providerType')]",
        "providerVersion": "2.0",
        "providerhubmetadata": {
           "providerAuthentication": {
                        "allowedAudiences": [
                            "https://management.core.windows.net/"
                        ]
                    },
          "providerauthorizations": "[parameters('providerAuthorizations')]"

        },
        "management": {
          "incidentRoutingService": "[parameters('incidentRoutingService')]",
          "incidentRoutingTeam": "[parameters('incidentRoutingTeam')]",
          "incidentContactEmail": "[parameters('incidentContactEmail')]"
        },
        "capabilities": [
          {
            "quotaId": "CSP_2015-05-01",
            "effect": "Allow"
          },
          {
            "quotaId": "CSP_MG_2017-12-01",
            "effect": "Allow"
          }
        ]
      }
    }
  ]
}